<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link href="./resources/css/reset.css" rel="stylesheet" type="text/css" />
    <link href="./resources/css/style.css" type="text/css" rel="stylesheet" />
    <title>Yopa Travel Guide</title>
    <script type="text/javascript"
        src="http://maps.google.com/maps/api/js?sensor=false"></script>

    <link href="/apis/fusiontables/docs/samples/style/default.css"
        rel="stylesheet" type="text/css">
    <style type="text/css">
      #map-canvas {
        width: auto;
      }

      #visualization {
        float: right;
      }

      #legend {
        background: #FFF;
        margin: 10px;
        padding: 5px;
        width: 150px;
      }

      #legend p {
        font-weight: bold;
        margin-top: 3px;
      }

      #legend div {
        clear: both;
      }

      .color {
        height: 12px;
        width: 12px;
        margin-right: 3px;
        float: left;
        display: block;
      }

      .high {
        color: #F00;
      }

      .medium {
        color: #0F0;
      }

      .low {
        color: #00F;
      }

      .high, .medium, .low {
        font-weight: bold;
      }
    </style>

    <script type="text/javascript">
      google.load('visualization', '1', { packages: ['corechart'] });

      /**
       * Sector type mapped to a style rule.
       * @type {Object}
       * @const
       */
      var LAYER_STYLES = {
        'Residential': {
          'min': 0,
          'max': 10000,
          'colors': [
            '#f4cccc',
            '#ea9999',
            '#e06666',
            '#cc0000',
            '#990000'
          ]
        },
        'Non-Residential': {
          'min': 0,
          'max': 10000,
          'colors': [
            '#d0e0e3',
            '#a2c4c9',
            '#76a5af',
            '#45818e',
            '#134f5c'
          ]
        },
        'Total': {
          'min': 0,
          'max': 20000,
          'colors': [
            '#d9d2e9',
            '#b4a7d6',
            '#8e7cc3',
            '#674ea7',
            '#351c75'
          ]
        }
      }

      function initialize() {
        var sector = 'Residential';

        var map = new google.maps.Map(document.getElementById('map-canvas'), {
          center: new google.maps.LatLng(37.4, -119.8),
          zoom: 5,
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          zoomControlOptions: {
            style: google.maps.ZoomControlStyle.SMALL
          },
        });

        var layer = new google.maps.FusionTablesLayer();
        updateLayerQuery(layer, sector);
        layer.setMap(map);

        createLegend(map, sector);
        styleLayerBySector(layer, sector);
        styleMap(map);
        drawVisualization('Alameda');

        google.maps.event.addListener(layer, 'click', function(e) {
          var county = e.row['County'].value;
          drawVisualization(county);

          var electricity = e.row['2010'].value;
          if (electricity > 5000) {
            e.infoWindowHtml = '<p class="high">High Usage!</p>';
          } else if (electricity > 2500) {
            e.infoWindowHtml = '<p class="medium">Medium Usage</p>';
          } else {
            e.infoWindowHtml = '<p class="low">Low Usage</p>';
          }
        });

        google.maps.event.addDomListener(document.getElementById('sector'),
            'change', function() {
              sector = this.value;
              updateLayerQuery(layer, sector);
              styleLayerBySector(layer, sector);
              updateLegend(sector);
            });

        google.maps.event.addDomListener(document.getElementById('county'),
            'change', function() {
              var county = this.value;
              updateLayerQuery(layer, sector, county);
              drawVisualization(county);
            });
      }

      function updateLayerQuery(layer, sector, county) {
        var where = "Sector = '" + sector + "'";
        if (county) {
          where += " AND County = '" + county + "'";
        }
        layer.setOptions({
          query: {
            select: 'geometry',
            from: '18fyPg1LvW3KB3N5DE_ub-MKicB0Nx7vkGn9kw4s',
            where: where
          }
        });
      }

      function createLegend(map, sector) {
        var legendWrapper = document.createElement('div');
        legendWrapper.id = 'legendWrapper';
        legendWrapper.index = 1;
        map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(
            legendWrapper);
        legendContent(legendWrapper, sector);
      }

      function legendContent(legendWrapper, sector) {
        var legend = document.createElement('div');
        legend.id = 'legend';

        var title = document.createElement('p');
        title.innerHTML = sector + ' Electricity Consumption';
        legend.appendChild(title);

        var layerStyle = LAYER_STYLES[sector];
        var colors = layerStyle.colors;
        var minNum = layerStyle.min;
        var maxNum = layerStyle.max;
        var step = (maxNum - minNum) / colors.length;
        for (var i = 0; i < colors.length; i++) {
          var legendItem = document.createElement('div');

          var color = document.createElement('div');
          color.setAttribute('class', 'color');
          color.style.backgroundColor = colors[i];
          legendItem.appendChild(color);

          var newMin = minNum + step * i;
          var newMax = newMin + step;
          var minMax = document.createElement('span');
          minMax.innerHTML = newMin + ' - ' + newMax;
          legendItem.appendChild(minMax);

          legend.appendChild(legendItem);
        }

        legendWrapper.appendChild(legend);
      }

      function updateLegend(sector) {
        var legendWrapper = document.getElementById('legendWrapper');
        var legend = document.getElementById('legend');
        legendWrapper.removeChild(legend);
        legendContent(legendWrapper, sector);
      }

      function styleLayerBySector(layer, sector) {
        var layerStyle = LAYER_STYLES[sector];
        var colors = layerStyle.colors;
        var minNum = layerStyle.min;
        var maxNum = layerStyle.max;
        var step = (maxNum - minNum) / colors.length;

        var styles = new Array();
        for (var i = 0; i < colors.length; i++) {
          var newMin = minNum + step * i;
          styles.push({
            where: generateWhere(newMin, sector),
            polygonOptions: {
              fillColor: colors[i],
              fillOpacity: 1
            }
          });
        }
        layer.set('styles', styles);
      }

      function generateWhere(minNum, sector) {
        var whereClause = new Array();
        whereClause.push("Sector = '");
        whereClause.push(sector);
        whereClause.push("' AND '2010' >= ");
        whereClause.push(minNum);
        return whereClause.join('');
      }

      function styleMap(map) {
        var style = [{
          featureType: 'all',
          stylers: [{
            saturation: -99
          }]
        }, {
          featureType: 'poi',
          stylers: [{
            visibility: 'off'
          }]
        }, {
          featureType: 'road',
          stylers: [{
            visibility: 'off'
          }]
        }];

        var styledMapType = new google.maps.StyledMapType(style, {
          map: map,
          name: 'Styled Map'
        });
        map.mapTypes.set('map-style', styledMapType);
        map.setMapTypeId('map-style');
      }

      function drawVisualization(county) {
        google.visualization.drawChart({
          containerId: "visualization",
          dataSourceUrl: "http://www.google.com/fusiontables/gvizdata?tq=",
          query: "SELECT Sector,'2006','2007','2008','2009','2010' " +
              "FROM 18fyPg1LvW3KB3N5DE_ub-MKicB0Nx7vkGn9kw4s WHERE County = '" + county + "'",
          chartType: "ColumnChart",
          options: {
            title: county,
            height: 400,
            width: 400
          }
        });
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div class="site-container">
      <div class="top-logo">
        <!-- top logo -->
        <img src="./resources/yopa-logo-navy-orange.svg" />
      </div>
      <button type="button">Book Free Valuation</button>
    </div>
    <div class="banner">
      <!-- banner -->
      <div class="banner-title">
        <!-- title centered inside the banner -->
        <h1>Yopa's London Commuter Guide</h1>
      </div>
    </div>
    <div class="site-container">
      <!-- intro to yopa -->
      <p>Every London professional thinks about it now and again: moving out of town.<br />

      And why not? London salary meets out-of- London living costs. Yep, definitely worth a bit of consideration, isn’t it?<br />

      So here at Yopa – lovely, helpful people that we are, always thinking of ways to make <a href="https://www.yopa.co.uk/homeowners-hub/" target="_blank">home- owners’ lives better</a> – have come up with a nice handy guide that shows the moving out options available to London’s workers: <strong>The London Commuter Guide</strong><br />

      At Yopa we like technology, so we’ve collected everything you could wish to know about London’s commuter towns, and mapped them out in this rather simple but clever little commuting tool.<br />

      And you can personalize it to your desired lifestyle. Want to get home in time to read the kids a goodnight story? Concerned about crime? Keen on long walks in the park? Big pub fan? Honestly, it's all in here.<br />

      And we’re updating it all the time, so it now even reflects the latest season ticket prices based on January 2018’s rail fare increases.<br />

      And if you do decide to sell your house and take the plunge, you know who to call.</p>
    </div>
    <div class="site-container" class="maps-api">
      <!-- google maps api -->
      <div id="visualization"></div>
      <div id="map-canvas"></div>
      <iframe width="500" height="300" scrolling="yes" frameborder="no" src="https://fusiontables.google.com/embedviz?viz=GVIZ&amp;t=TABLE&amp;q=select+col0%2C+col1%2C+col2%2C+col3%2C+col4%2C+col5%2C+col6%2C+col7%2C+col8%2C+col9%2C+col10+from+1whZPNz7uJECoemagjAzXYaoH30zDVCXIhRqnmhtQ&amp;containerId=googft-gviz-canvas"></iframe>
      <div class="maps-info">
        <!-- settings and filters on maps api -->
        <!-- This form needs to be changed to suit the maps api London -->
        <form>
          <label>Sector </label>
          <select id="sector">
            <option value="Residential">Residential</option>
            <option value="Non-Residential">Non-Residential</option>
            <option value="Total">Total</option>
          </select>
          <label>County</label>
          <select id="county">
            <option value="Alameda">Alameda</option>
            <option value="Alpine">Alpine</option>
          </select>
        </form>
      </div>
    </div>
    <div class=results-table class="site-container">
      <!-- results shown in the table using results from maps api -->
      <h1>Your Personalised 'Top 10'</h1>
      <p>Based on your requirements entered, here are Yopa's top 10 suggestions for the best commuter towns you could live in:</p>

    </div>
    <footer class="site-container">
      <!-- footer -->
      <p>Spotted any errors or inaccuracies? Please let us know by emailing us here!<br />

      Sources used: Zoopla, Police.uk, National Rail Enquiries, gov.uk, Beer in the Evening, closestairportto.com, The Commuter Guide, Google Maps and Wikipedia. Crime data is correct as of June 2017, and for some suburbs the parent city's data has been used. Good+ schools are defined as having Good or Excellent scores in their last Ofsted inpections. All London commuter towns on this page are located outside of the M25.<br />

      Please note: not all commutable locations have been included, but any recommendations are always appreciated - please email us at the address above.<br />

      © 2018 Yopa Property Limited Registered in England and Wales No. 09120252
      Registered Office: Acre House, 11/15 William Road, London, NW1 3ER</p>
    </footer>
  </body>
</html>
